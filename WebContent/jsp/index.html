
<!DOCTYPE html>
<html>
  <head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    
    <style type="text/css">
      html { height: 100%; width: 75%; }
      body { height: 100%; width: 100%; margin: 10; padding: 0 }
	 

      #map-canvas { height: 100%;width:85%;float:left }
    </style>

    
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbE4ZuFxcpxe4w7ddJqs3ssNPn2r0cwoA&sensor=false&libraries=places"></script>
    <script>

var map;
var markersArray = [];
var poly;
var start;
var end;
var nocities=0;
var directionsService = new google.maps.DirectionsService();
var directionsDisplay;
var pathArray = new Array();
//var marker;
var cnt = 0;
function initialize() {
    var rendererOptions = {
         draggable: true
    };
    directionsDisplay = new google.maps.DirectionsRenderer(rendererOptions);

  var currentLocation = new google.maps.LatLng(13.003638,77.599769);
  var mapOptions = {
    zoom: 15,
    center: currentLocation,
    scrollwheel: false,
    scaleControl: false,
    mapTypeId: google.maps.MapTypeId.TERRAIN
  };
    map =  new google.maps.Map(document.getElementById("map-canvas"), mapOptions);

    var polyOptions = {
    strokeColor: '#000000',
    strokeOpacity: 0.0,
    strokeWeight: 10
  }
  poly = new google.maps.Polyline(polyOptions);
  poly.setMap(map);  
  directionsDisplay.setMap(map);



  
  google.maps.event.addListener(map, 'click', function(event) {
    nocities++;
    if (nocities < 3) {
       populateLatLng(event.latLng)
       addMarker(event.latLng);
    }
  });
  
  google.maps.event.addListener(directionsDisplay, 'directions_changed', function() {
	    // alert("directions chnaged!" + JSON.stringify(directionsDisplay.directions));
	    getPointsAlongRoute(directionsDisplay.directions.routes);
	  });

}


function populateLatLng (latLng)
{
     prefix = "from";
     if (cnt == 1) {
         prefix = "to";
         cnt = 0;
     }
     else {
         cnt = 1;
     }     
     document.getElementById(prefix+"LatLng").value = latLng;
}



function addMarker(location) {
     //alert(location);
     marker = new google.maps.Marker({
                   position: location,
                   map: map
     });
     var path = poly.getPath();
     path.push(location);
     if (nocities > 1) {
        calcRoute(path);
     }
}

function calcRoute(rtepath) {
    var i;
    var waypts=[];
    start = rtepath.getAt(0);
    end = rtepath.getAt(1);
    var request = {
      origin:start,
      destination:end,
	  waypoints: waypts,
      optimizeWaypoints: true,	  
      travelMode: google.maps.DirectionsTravelMode.DRIVING
    };
    directionsService.route(request, function(response, status) {
    	if (status == google.maps.DirectionsStatus.OK) {
  	      directionsDisplay.setDirections(response);
	      getPointsAlongRoute(response.routes); 
    	}
  });
}

function getPointsAlongRoute (routes) {
	//alert(JSON.stringify(response));
    //alert(response.routes.length);
    pathArray.length=0;
    for (var i=0; i<routes.length; i++) {
      var route = routes[i];  
  	  for (var j=0; j<route.legs.length; j++) {
  		  var steps = route.legs[j].steps;
  		  //prompt("",JSON.stringify(route.legs[j]));
  		  for (var k=0; k<steps.length; k++) {
				pathArray.push(steps[k].start_location.pb+":"+steps[k].start_location.qb);		
          }
       }
     }
    document.getElementById("latlangpath").value = JSON.stringify(pathArray);
}

google.maps.event.addDomListener(window, 'load', initialize);


function populateMonths ()
{
    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"];
    createOptions(document.getElementById("fromMonth"), months);
    createOptions(document.getElementById("toMonth"), months);
}

function populateDate ()
{
    createOptionsForVal(document.getElementById("fromDate"), 1, 31);
    createOptionsForVal(document.getElementById("toDate"), 1, 31);    
}

function populateYear ()
{
    createOptionsForVal(document.getElementById("fromYear"), 2010, 2013);   
    createOptionsForVal(document.getElementById("toYear"), 2010, 2013);  
}

function populateHour ()
{
    createOptionsForVal(document.getElementById("fromHr"), 0, 23);
    createOptionsForVal(document.getElementById("toHr"), 0, 23);      
}

function populateMin ()
{
    createOptionsForVal(document.getElementById("fromMin"), 0, 59);  
    createOptionsForVal(document.getElementById("toMin"), 0, 59);   
}


function createOptions (selectObject, dataObj)
{
    for (var i=0; i<dataObj.length; i++) {
        var el = document.createElement("option");
        el.text = dataObj[i];
        el.value = i;
        selectObject.appendChild(el);
    }
}    

function createOptionsForVal (selectObject, fromVal, toVal)
{
    for (var i=fromVal; i<=toVal; i++) {
        var el = document.createElement("option");
        el.text = i;
        el.value = i;
        selectObject.appendChild(el);
    }
}


function doSubmit ()
{
    return true; 
}


</script>
  </head>
  <body>
    <div id="map-canvas"></div>
    <div id="form1">
        <form name="mapform" id="mapform" method="post" action="trafficmap">
        <input type="hidden" name="fromLatLng" id="fromLatLng" value="" />
        <input type="hidden" name="toLatLng" id="toLatLng" value="" />
        <input type="hidden" name="latlangpath" id="latlangpath" value="" />
                          
        <table>
            <tr>
               <th colspan="9" align="left">Enter Start Date and Time </th>
            </tr>
            <tr>
               <td><select name="fromMonth" id="fromMonth"></select></td><td>/</td>
               <td><select name="fromDate" id="fromDate"></select></td><td>/</td>
               <td><select name="fromYear" id="fromYear"></select></td><td>--</td>
               <td><select name="fromHr" id="fromHr"></select></td><td>:</td>
               <td><select name="fromMin" id="fromMin"></select></td>  
            </tr>
            <tr><td><br/></td></tr>
            <tr>
                <th colspan="9" align="left">Enter End Date and Time </th>
            </tr>
            <tr>   
                <td><select name="toMonth" id="toMonth"></select></td><td>/</td>
                <td><select name="toDate" id="toDate"></select></td><td>/</td>
                <td><select name="toYear" id="toYear"></select></td><td>--</td>
                <td><select name="toHr" id="toHr"></select></td><td>:</td>
                <td><select name="toMin" id="toMin"></select></td>
             </tr>
            <tr><td><br/></td></tr>
            <tr>
                <td><input type="submit" value="Submit" onClick="doSubmit()"/></td>
            </tr>
        </table>
        </form>
        <script>
            populateMonths();
            populateDate();
            populateYear();
            populateHour();
            populateMin();
        </script>
    </div>
  </body>
</html>